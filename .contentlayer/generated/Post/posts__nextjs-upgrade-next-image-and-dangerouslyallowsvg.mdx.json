{
  "title": "NextJS Upgrade, next/image, and dangerouslyAllowSVG",
  "image": null,
  "description": "Our team recently faced the task of upgrading NodeJS from version 16 to 18 due to the upcoming end of support for NodeJS 14 and 16 by Vercel. As Vercel is phasing out support for NodeJS 14 and 16 on Aug 15, 2023, and Feb 4, 2024 respectively, we had to ensure our application could run on the latest supported version.",
  "date": "Aug 21 2023",
  "body": {
    "raw": "\n# NextJS Upgrade, next/image, and dangerouslyAllowSVG\n\n<img src='' alt='' />\n\nOur team recently faced the task of upgrading NodeJS from version 16 to 18 due to the upcoming end of support for NodeJS 14 and 16 by Vercel. As Vercel is phasing out support for NodeJS 14 and 16 on Aug 15, 2023, and Feb 4, 2024 respectively, we had to ensure our application could run on the latest supported version.\n\n\nDuring the upgrade, we also needed to update NextJS from version 11 to version 12, along with several other packages, including Storybook and webpack, which was also dependent on Storybook. While performing the upgrade, we encountered a peculiar issue related to NextJS image support for SVG images.\n\nThe problem arose with two different images that were sourced from the same place, a headless CMS. Surprisingly, one of the images displayed without any issues, while the other had trouble loading.\n\nOn further investigation, we discovered that NextJS optimizes images hosted on the same domain as the app by default. Since our images were hosted externally on the CMS, we had to specify which domains were allowed to be optimized. But we already had the required domains added to the **configuration(next.config.js)**;\n\n```ts\n  images: {\n    domains: [\n      ‚Äúabc-demo.cdn.prismic.io\",\n      \"images.prismic.io\",\n    ],\n  },\n```\n\nand the issue persisted.\n\nTo solve the problem, we set the configuration option dangerouslyAllowSVG to true in the Next.js config, which resolved the issue üéâ.\n\n```ts\n images: {\n    dangerouslyAllowSVG: true,\n    domains: [\n      \"abc-demo.cdn.prismic.io\",\n      \"images.prismic.io\",\n    ],\n  },\n```\n\nThe **dangerouslyAllowSVG: true** configuration option allows us to explicitly override these safety checks and enable the display of SVG images that contain the **auto=compress,format** parameter. However, it is called _‚Äúdangerously‚Äù_ because it bypasses some of the security checks that NextJS typically applies to SVG images.\n\nIn addition, <u>according to this documentation</u>, NextJS recommends to use **contentDispositionType** and **contentSecurityPolicy** properties along with **dangerouslyAllowSVG** to make the implementation more secure.\n\nü§î Even though we found a solution, we were still curious about why these two seemingly similar images behaved differently previously.\n\nSo, we started the examination again removing the dangerouslyAllowSVG from configuration. On closer examination, we noticed differences in the source URLs of both images which looked something like this:\n\n> Image Source 1: https://images.prismic.io/abc-demo/7723d14c-1233-4550-92da-59da4a86218f_Nav+Icon_Banking.svg?auto=compress,format\n\n> Image Source 2: https://abc-demo.cdn.prismic.io/abc-demo/9ddebda9-26bc-49c1-b2c0-55d7bdc52c13_New_Banner.svg\n\nAlthough both domains were added to the NextJS image configuration, the issue persisted. Besides, we were thinking that since both the images were in SVG format, so they should have behaved the same way.\n\nOne crucial difference between the two URLs, that you must also have already noticed, was the presence of the **auto=compress,format** parameter in _Image Source 1_. We removed the parameter and hard coded the image url as image source in NextJS Image component. The image gets loaded.\n\nIt worked!!! üéâ\n\nYes, that was the culprit and on investigating further we discovered that in NextJS v12(and above, I guess), there are some optimizations related to how images are handled.\n\nSpecifically, when an SVG image _URL does not contain_ the **auto=compress,format** parameter, NextJS automatically loads the image without optimizing or processing the SVG image.\n\n\n> By default NextJS does not optimize SVG images for a few reasons. First, SVG is a vector format meaning it can be resized losslessly. Second, SVG has many of the same features as HTML/CSS, which can lead to vulnerabilities without proper Content Security Policy (CSP) headers.\n\nOn the other hand, when the SVG image _URL does contain_ the **auto=compress,format** parameter, it usually indicates that the image should be processed by the server or content delivery network (CDN) to optimize its size and format automatically before it is delivered to the user‚Äôs browser. In this case, what we reckon is that NextJS image API also tried to apply its optimization process(including its security measures) which somehow resulted in the image type change to **plain/text** and which further led to the failure.\n\nThe _key aspect to note_ here is that the **auto=compress,format** parameter was originally introduced by Prismic in conjunction with imigix to optimize images. However, when this parameter was passed to Next.js‚Äôs Image API, it might have been interpreted differently, potentially leading to a change in the image‚Äôs MIME type. This variation in how the parameter was handled could have caused the image loading issues that were encountered during the integration.\n\nIndeed, these findings aligned with our observations. ü§î But, we have yet to gain a clear understanding of how exactly the NextJS API processes the **auto=compress,format** parameter. Further investigation is required to ascertain the specific behavior and implications of this parameter when used in conjunction with the NextJS Image API. I‚Äôve also opened a [discussion in GitHub](https://github.com/vercel/next.js/discussions/53041) regarding this issue. Hope we get some answers from there as well.\n\nHappy coding! üéâ\n\n\n\n\n\n\n",
    "code": "var Component=(()=>{var cn=Object.create;var F=Object.defineProperty;var ln=Object.getOwnPropertyDescriptor;var dn=Object.getOwnPropertyNames;var mn=Object.getPrototypeOf,fn=Object.prototype.hasOwnProperty;var U=(l,n)=>()=>(n||l((n={exports:{}}).exports,n),n.exports),bn=(l,n)=>{for(var h in n)F(l,h,{get:n[h],enumerable:!0})},ye=(l,n,h,N)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let x of dn(n))!fn.call(l,x)&&x!==h&&F(l,x,{get:()=>n[x],enumerable:!(N=ln(n,x))||N.enumerable});return l};var pn=(l,n,h)=>(h=l!=null?cn(mn(l)):{},ye(n||!l||!l.__esModule?F(h,\"default\",{value:l,enumerable:!0}):h,l)),hn=l=>ye(F({},\"__esModule\",{value:!0}),l);var Ee=U((vn,ve)=>{ve.exports=React});var je=U(z=>{\"use strict\";(function(){\"use strict\";var l=Ee(),n=Symbol.for(\"react.element\"),h=Symbol.for(\"react.portal\"),N=Symbol.for(\"react.fragment\"),x=Symbol.for(\"react.strict_mode\"),q=Symbol.for(\"react.profiler\"),H=Symbol.for(\"react.provider\"),X=Symbol.for(\"react.context\"),S=Symbol.for(\"react.forward_ref\"),A=Symbol.for(\"react.suspense\"),I=Symbol.for(\"react.suspense_list\"),R=Symbol.for(\"react.memo\"),V=Symbol.for(\"react.lazy\"),Re=Symbol.for(\"react.offscreen\"),K=Symbol.iterator,Te=\"@@iterator\";function Ce(e){if(e===null||typeof e!=\"object\")return null;var t=K&&e[K]||e[Te];return typeof t==\"function\"?t:null}var v=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function f(e){{for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];ke(\"error\",e,o)}}function ke(e,t,o){{var a=v.ReactDebugCurrentFrame,u=a.getStackAddendum();u!==\"\"&&(t+=\"%s\",o=o.concat([u]));var c=o.map(function(i){return String(i)});c.unshift(\"Warning: \"+t),Function.prototype.apply.call(console[e],console,c)}}var Oe=!1,Pe=!1,Fe=!1,Ae=!1,Ie=!1,Z;Z=Symbol.for(\"react.module.reference\");function Ve(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===N||e===q||Ie||e===x||e===A||e===I||Ae||e===Re||Oe||Pe||Fe||typeof e==\"object\"&&e!==null&&(e.$$typeof===V||e.$$typeof===R||e.$$typeof===H||e.$$typeof===X||e.$$typeof===S||e.$$typeof===Z||e.getModuleId!==void 0))}function Be(e,t,o){var a=e.displayName;if(a)return a;var u=t.displayName||t.name||\"\";return u!==\"\"?o+\"(\"+u+\")\":o}function Q(e){return e.displayName||\"Context\"}function _(e){if(e==null)return null;if(typeof e.tag==\"number\"&&f(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case N:return\"Fragment\";case h:return\"Portal\";case q:return\"Profiler\";case x:return\"StrictMode\";case A:return\"Suspense\";case I:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case X:var t=e;return Q(t)+\".Consumer\";case H:var o=e;return Q(o._context)+\".Provider\";case S:return Be(e,e.render,\"ForwardRef\");case R:var a=e.displayName||null;return a!==null?a:_(e.type)||\"Memo\";case V:{var u=e,c=u._payload,i=u._init;try{return _(i(c))}catch{return null}}}return null}var y=Object.assign,D=0,ee,ne,re,te,oe,ae,se;function ie(){}ie.__reactDisabledLog=!0;function Ge(){{if(D===0){ee=console.log,ne=console.info,re=console.warn,te=console.error,oe=console.group,ae=console.groupCollapsed,se=console.groupEnd;var e={configurable:!0,enumerable:!0,value:ie,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}D++}}function Me(){{if(D--,D===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:y({},e,{value:ee}),info:y({},e,{value:ne}),warn:y({},e,{value:re}),error:y({},e,{value:te}),group:y({},e,{value:oe}),groupCollapsed:y({},e,{value:ae}),groupEnd:y({},e,{value:se})})}D<0&&f(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var B=v.ReactCurrentDispatcher,G;function T(e,t,o){{if(G===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\\n( *(at )?)/);G=a&&a[1]||\"\"}return`\n`+G+e}}var M=!1,C;{var We=typeof WeakMap==\"function\"?WeakMap:Map;C=new We}function ue(e,t){if(!e||M)return\"\";{var o=C.get(e);if(o!==void 0)return o}var a;M=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var c;c=B.current,B.current=null,Ge();try{if(t){var i=function(){throw Error()};if(Object.defineProperty(i.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(i,[])}catch(g){a=g}Reflect.construct(e,[],i)}else{try{i.call()}catch(g){a=g}e.call(i.prototype)}}else{try{throw Error()}catch(g){a=g}e()}}catch(g){if(g&&a&&typeof g.stack==\"string\"){for(var s=g.stack.split(`\n`),b=a.stack.split(`\n`),d=s.length-1,m=b.length-1;d>=1&&m>=0&&s[d]!==b[m];)m--;for(;d>=1&&m>=0;d--,m--)if(s[d]!==b[m]){if(d!==1||m!==1)do if(d--,m--,m<0||s[d]!==b[m]){var p=`\n`+s[d].replace(\" at new \",\" at \");return e.displayName&&p.includes(\"<anonymous>\")&&(p=p.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&C.set(e,p),p}while(d>=1&&m>=0);break}}}finally{M=!1,B.current=c,Me(),Error.prepareStackTrace=u}var j=e?e.displayName||e.name:\"\",Ne=j?T(j):\"\";return typeof e==\"function\"&&C.set(e,Ne),Ne}function Ye(e,t,o){return ue(e,!1)}function Je(e){var t=e.prototype;return!!(t&&t.isReactComponent)}function k(e,t,o){if(e==null)return\"\";if(typeof e==\"function\")return ue(e,Je(e));if(typeof e==\"string\")return T(e);switch(e){case A:return T(\"Suspense\");case I:return T(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case S:return Ye(e.render);case R:return k(e.type,t,o);case V:{var a=e,u=a._payload,c=a._init;try{return k(c(u),t,o)}catch{}}}return\"\"}var O=Object.prototype.hasOwnProperty,ce={},le=v.ReactDebugCurrentFrame;function P(e){if(e){var t=e._owner,o=k(e.type,e._source,t?t.type:null);le.setExtraStackFrame(o)}else le.setExtraStackFrame(null)}function Le(e,t,o,a,u){{var c=Function.call.bind(O);for(var i in e)if(c(e,i)){var s=void 0;try{if(typeof e[i]!=\"function\"){var b=Error((a||\"React class\")+\": \"+o+\" type `\"+i+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[i]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw b.name=\"Invariant Violation\",b}s=e[i](t,i,a,o,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(d){s=d}s&&!(s instanceof Error)&&(P(u),f(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",a||\"React class\",o,i,typeof s),P(null)),s instanceof Error&&!(s.message in ce)&&(ce[s.message]=!0,P(u),f(\"Failed %s type: %s\",o,s.message),P(null))}}}var $e=Array.isArray;function W(e){return $e(e)}function Ue(e){{var t=typeof Symbol==\"function\"&&Symbol.toStringTag,o=t&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return o}}function ze(e){try{return de(e),!1}catch{return!0}}function de(e){return\"\"+e}function me(e){if(ze(e))return f(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",Ue(e)),de(e)}var w=v.ReactCurrentOwner,qe={key:!0,ref:!0,__self:!0,__source:!0},fe,be,Y;Y={};function He(e){if(O.call(e,\"ref\")){var t=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(t&&t.isReactWarning)return!1}return e.ref!==void 0}function Xe(e){if(O.call(e,\"key\")){var t=Object.getOwnPropertyDescriptor(e,\"key\").get;if(t&&t.isReactWarning)return!1}return e.key!==void 0}function Ke(e,t){if(typeof e.ref==\"string\"&&w.current&&t&&w.current.stateNode!==t){var o=_(w.current.type);Y[o]||(f('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',_(w.current.type),e.ref),Y[o]=!0)}}function Ze(e,t){{var o=function(){fe||(fe=!0,f(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",t))};o.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:o,configurable:!0})}}function Qe(e,t){{var o=function(){be||(be=!0,f(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",t))};o.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:o,configurable:!0})}}var en=function(e,t,o,a,u,c,i){var s={$$typeof:n,type:e,key:t,ref:o,props:i,_owner:c};return s._store={},Object.defineProperty(s._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(s,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:a}),Object.defineProperty(s,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:u}),Object.freeze&&(Object.freeze(s.props),Object.freeze(s)),s};function nn(e,t,o,a,u){{var c,i={},s=null,b=null;o!==void 0&&(me(o),s=\"\"+o),Xe(t)&&(me(t.key),s=\"\"+t.key),He(t)&&(b=t.ref,Ke(t,u));for(c in t)O.call(t,c)&&!qe.hasOwnProperty(c)&&(i[c]=t[c]);if(e&&e.defaultProps){var d=e.defaultProps;for(c in d)i[c]===void 0&&(i[c]=d[c])}if(s||b){var m=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;s&&Ze(i,m),b&&Qe(i,m)}return en(e,s,b,u,a,w.current,i)}}var J=v.ReactCurrentOwner,pe=v.ReactDebugCurrentFrame;function E(e){if(e){var t=e._owner,o=k(e.type,e._source,t?t.type:null);pe.setExtraStackFrame(o)}else pe.setExtraStackFrame(null)}var L;L=!1;function $(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===n}function he(){{if(J.current){var e=_(J.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function rn(e){{if(e!==void 0){var t=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),o=e.lineNumber;return`\n\nCheck your code at `+t+\":\"+o+\".\"}return\"\"}}var _e={};function tn(e){{var t=he();if(!t){var o=typeof e==\"string\"?e:e.displayName||e.name;o&&(t=`\n\nCheck the top-level render call using <`+o+\">.\")}return t}}function ge(e,t){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var o=tn(t);if(_e[o])return;_e[o]=!0;var a=\"\";e&&e._owner&&e._owner!==J.current&&(a=\" It was passed a child from \"+_(e._owner.type)+\".\"),E(e),f('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',o,a),E(null)}}function xe(e,t){{if(typeof e!=\"object\")return;if(W(e))for(var o=0;o<e.length;o++){var a=e[o];$(a)&&ge(a,t)}else if($(e))e._store&&(e._store.validated=!0);else if(e){var u=Ce(e);if(typeof u==\"function\"&&u!==e.entries)for(var c=u.call(e),i;!(i=c.next()).done;)$(i.value)&&ge(i.value,t)}}}function on(e){{var t=e.type;if(t==null||typeof t==\"string\")return;var o;if(typeof t==\"function\")o=t.propTypes;else if(typeof t==\"object\"&&(t.$$typeof===S||t.$$typeof===R))o=t.propTypes;else return;if(o){var a=_(t);Le(o,e.props,\"prop\",a,e)}else if(t.PropTypes!==void 0&&!L){L=!0;var u=_(t);f(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",u||\"Unknown\")}typeof t.getDefaultProps==\"function\"&&!t.getDefaultProps.isReactClassApproved&&f(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function an(e){{for(var t=Object.keys(e.props),o=0;o<t.length;o++){var a=t[o];if(a!==\"children\"&&a!==\"key\"){E(e),f(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",a),E(null);break}}e.ref!==null&&(E(e),f(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),E(null))}}function sn(e,t,o,a,u,c){{var i=Ve(e);if(!i){var s=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(s+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var b=rn(u);b?s+=b:s+=he();var d;e===null?d=\"null\":W(e)?d=\"array\":e!==void 0&&e.$$typeof===n?(d=\"<\"+(_(e.type)||\"Unknown\")+\" />\",s=\" Did you accidentally export a JSX literal instead of a component?\"):d=typeof e,f(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",d,s)}var m=nn(e,t,o,u,c);if(m==null)return m;if(i){var p=t.children;if(p!==void 0)if(a)if(W(p)){for(var j=0;j<p.length;j++)xe(p[j],e);Object.freeze&&Object.freeze(p)}else f(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else xe(p,e)}return e===N?an(m):on(m),m}}var un=sn;z.Fragment=N,z.jsxDEV=un})()});var we=U((jn,De)=>{\"use strict\";De.exports=je()});var Nn={};bn(Nn,{default:()=>xn,frontmatter:()=>_n});var r=pn(we()),_n={title:\"NextJS Upgrade, next/image, and dangerouslyAllowSVG\",description:\"Our team recently faced the task of upgrading NodeJS from version 16 to 18 due to the upcoming end of support for NodeJS 14 and 16 by Vercel. As Vercel is phasing out support for NodeJS 14 and 16 on Aug 15, 2023, and Feb 4, 2024 respectively, we had to ensure our application could run on the latest supported version.\",date:\"Aug 21 2023\",image:null};function Se(l){let n=Object.assign({h1:\"h1\",a:\"a\",span:\"span\",p:\"p\",strong:\"strong\",div:\"div\",pre:\"pre\",code:\"code\",em:\"em\",blockquote:\"blockquote\"},l.components);return(0,r.jsxDEV)(r.Fragment,{children:[(0,r.jsxDEV)(n.h1,{id:\"nextjs-upgrade-nextimage-and-dangerouslyallowsvg\",children:[(0,r.jsxDEV)(n.a,{className:\"subheading-anchor\",\"aria-label\":\"Link to section\",href:\"#nextjs-upgrade-nextimage-and-dangerouslyallowsvg\",children:(0,r.jsxDEV)(n.span,{className:\"icon icon-link\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\"},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\"},this),\"NextJS Upgrade, next/image, and dangerouslyAllowSVG\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:8,columnNumber:1},this),`\n`,(0,r.jsxDEV)(\"img\",{src:\"\",alt:\"\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:10,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"Our team recently faced the task of upgrading NodeJS from version 16 to 18 due to the upcoming end of support for NodeJS 14 and 16 by Vercel. As Vercel is phasing out support for NodeJS 14 and 16 on Aug 15, 2023, and Feb 4, 2024 respectively, we had to ensure our application could run on the latest supported version.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:12,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"During the upgrade, we also needed to update NextJS from version 11 to version 12, along with several other packages, including Storybook and webpack, which was also dependent on Storybook. While performing the upgrade, we encountered a peculiar issue related to NextJS image support for SVG images.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:15,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"The problem arose with two different images that were sourced from the same place, a headless CMS. Surprisingly, one of the images displayed without any issues, while the other had trouble loading.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:17,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"On further investigation, we discovered that NextJS optimizes images hosted on the same domain as the app by default. Since our images were hosted externally on the CMS, we had to specify which domains were allowed to be optimized. But we already had the required domains added to the \",(0,r.jsxDEV)(n.strong,{children:\"configuration(next.config.js)\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:19,columnNumber:286},this),\";\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:19,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,r.jsxDEV)(n.pre,{style:{backgroundColor:\"#24292e\"},tabIndex:\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",children:(0,r.jsxDEV)(n.code,{\"data-language\":\"ts\",\"data-theme\":\"default\",style:{display:\"grid\"},children:[(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"  \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(n.span,{style:{color:\"#B392F0\"},children:\"images\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:142},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\": {\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:184},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:85},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"    \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#B392F0\"},children:\"domains\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:60},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\": [\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:103},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"      \\u201Cabc\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#F97583\"},children:\"-\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:66},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"demo.cdn.prismic.io\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:103},this),(0,r.jsxDEV)(n.span,{style:{color:\"#9ECBFF\"},children:'\"'},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:158},this),(0,r.jsxDEV)(n.span,{style:{color:\"#FDAEB7\",fontStyle:\"italic\"},children:\",\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:200},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"      \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#9ECBFF\"},children:'\"images.prismic.io\"'},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:62},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:127},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ],\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:20},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"  },\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:6,columnNumber:20},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:6,columnNumber:1},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:21,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"and the issue persisted.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:30,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"To solve the problem, we set the configuration option dangerouslyAllowSVG to true in the Next.js config, which resolved the issue \\u{1F389}.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:32,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.div,{\"data-rehype-pretty-code-fragment\":\"\",children:(0,r.jsxDEV)(n.pre,{style:{backgroundColor:\"#24292e\"},tabIndex:\"0\",\"data-language\":\"ts\",\"data-theme\":\"default\",children:(0,r.jsxDEV)(n.code,{\"data-language\":\"ts\",\"data-theme\":\"default\",style:{display:\"grid\"},children:[(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\" \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:104},this),(0,r.jsxDEV)(n.span,{style:{color:\"#B392F0\"},children:\"images\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:141},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\": {\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:183},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:85},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"    \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#B392F0\"},children:\"dangerouslyAllowSVG\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:60},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\": \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:115},this),(0,r.jsxDEV)(n.span,{style:{color:\"#79B8FF\"},children:\"true\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:153},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:193},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:2,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"    \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#B392F0\"},children:\"domains\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:60},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\": [\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:103},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:3,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"      \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#9ECBFF\"},children:'\"abc-demo.cdn.prismic.io\"'},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:62},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:133},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:4,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:[(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"      \"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:20},this),(0,r.jsxDEV)(n.span,{style:{color:\"#9ECBFF\"},children:'\"images.prismic.io\"'},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:62},this),(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\",\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:127},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:5,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"    ],\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:6,columnNumber:20},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:6,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.span,{\"data-line\":\"\",children:(0,r.jsxDEV)(n.span,{style:{color:\"#E1E4E8\"},children:\"  },\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:7,columnNumber:20},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:7,columnNumber:1},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:79},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:1},this)},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:34,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"The \",(0,r.jsxDEV)(n.strong,{children:\"dangerouslyAllowSVG: true\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:44,columnNumber:5},this),\" configuration option allows us to explicitly override these safety checks and enable the display of SVG images that contain the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:44,columnNumber:163},this),\" parameter. However, it is called \",(0,r.jsxDEV)(n.em,{children:\"\\u201Cdangerously\\u201D\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:44,columnNumber:221},this),\" because it bypasses some of the security checks that NextJS typically applies to SVG images.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:44,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"In addition, \",(0,r.jsxDEV)(\"u\",{children:\"according to this documentation\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:46,columnNumber:14},this),\", NextJS recommends to use \",(0,r.jsxDEV)(n.strong,{children:\"contentDispositionType\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:46,columnNumber:79},this),\" and \",(0,r.jsxDEV)(n.strong,{children:\"contentSecurityPolicy\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:46,columnNumber:110},this),\" properties along with \",(0,r.jsxDEV)(n.strong,{children:\"dangerouslyAllowSVG\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:46,columnNumber:158},this),\" to make the implementation more secure.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:46,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"\\u{1F914} Even though we found a solution, we were still curious about why these two seemingly similar images behaved differently previously.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:48,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"So, we started the examination again removing the dangerouslyAllowSVG from configuration. On closer examination, we noticed differences in the source URLs of both images which looked something like this:\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:50,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.blockquote,{children:[`\n`,(0,r.jsxDEV)(n.p,{children:[\"Image Source 1: \",(0,r.jsxDEV)(n.a,{href:\"https://images.prismic.io/abc-demo/7723d14c-1233-4550-92da-59da4a86218f_Nav+Icon_Banking.svg?auto=compress,format\",children:\"https://images.prismic.io/abc-demo/7723d14c-1233-4550-92da-59da4a86218f_Nav+Icon_Banking.svg?auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:52,columnNumber:19},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:52,columnNumber:3},this),`\n`]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:52,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.blockquote,{children:[`\n`,(0,r.jsxDEV)(n.p,{children:[\"Image Source 2: \",(0,r.jsxDEV)(n.a,{href:\"https://abc-demo.cdn.prismic.io/abc-demo/9ddebda9-26bc-49c1-b2c0-55d7bdc52c13_New_Banner.svg\",children:\"https://abc-demo.cdn.prismic.io/abc-demo/9ddebda9-26bc-49c1-b2c0-55d7bdc52c13_New_Banner.svg\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:54,columnNumber:19},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:54,columnNumber:3},this),`\n`]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:54,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"Although both domains were added to the NextJS image configuration, the issue persisted. Besides, we were thinking that since both the images were in SVG format, so they should have behaved the same way.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:56,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"One crucial difference between the two URLs, that you must also have already noticed, was the presence of the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:58,columnNumber:111},this),\" parameter in \",(0,r.jsxDEV)(n.em,{children:\"Image Source 1\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:58,columnNumber:149},this),\". We removed the parameter and hard coded the image url as image source in NextJS Image component. The image gets loaded.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:58,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"It worked!!! \\u{1F389}\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:60,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"Yes, that was the culprit and on investigating further we discovered that in NextJS v12(and above, I guess), there are some optimizations related to how images are handled.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:62,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"Specifically, when an SVG image \",(0,r.jsxDEV)(n.em,{children:\"URL does not contain\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:64,columnNumber:33},this),\" the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:64,columnNumber:60},this),\" parameter, NextJS automatically loads the image without optimizing or processing the SVG image.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:64,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.blockquote,{children:[`\n`,(0,r.jsxDEV)(n.p,{children:\"By default NextJS does not optimize SVG images for a few reasons. First, SVG is a vector format meaning it can be resized losslessly. Second, SVG has many of the same features as HTML/CSS, which can lead to vulnerabilities without proper Content Security Policy (CSP) headers.\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:67,columnNumber:3},this),`\n`]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:67,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"On the other hand, when the SVG image \",(0,r.jsxDEV)(n.em,{children:\"URL does contain\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:69,columnNumber:39},this),\" the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:69,columnNumber:62},this),\" parameter, it usually indicates that the image should be processed by the server or content delivery network (CDN) to optimize its size and format automatically before it is delivered to the user\\u2019s browser. In this case, what we reckon is that NextJS image API also tried to apply its optimization process(including its security measures) which somehow resulted in the image type change to \",(0,r.jsxDEV)(n.strong,{children:\"plain/text\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:69,columnNumber:477},this),\" and which further led to the failure.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:69,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"The \",(0,r.jsxDEV)(n.em,{children:\"key aspect to note\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:71,columnNumber:5},this),\" here is that the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:71,columnNumber:43},this),\" parameter was originally introduced by Prismic in conjunction with imigix to optimize images. However, when this parameter was passed to Next.js\\u2019s Image API, it might have been interpreted differently, potentially leading to a change in the image\\u2019s MIME type. This variation in how the parameter was handled could have caused the image loading issues that were encountered during the integration.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:71,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:[\"Indeed, these findings aligned with our observations. \\u{1F914} But, we have yet to gain a clear understanding of how exactly the NextJS API processes the \",(0,r.jsxDEV)(n.strong,{children:\"auto=compress,format\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:73,columnNumber:149},this),\" parameter. Further investigation is required to ascertain the specific behavior and implications of this parameter when used in conjunction with the NextJS Image API. I\\u2019ve also opened a \",(0,r.jsxDEV)(n.a,{href:\"https://github.com/vercel/next.js/discussions/53041\",children:\"discussion in GitHub\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:73,columnNumber:360},this),\" regarding this issue. Hope we get some answers from there as well.\"]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:73,columnNumber:1},this),`\n`,(0,r.jsxDEV)(n.p,{children:\"Happy coding! \\u{1F389}\"},void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:75,columnNumber:1},this)]},void 0,!0,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\",lineNumber:1,columnNumber:1},this)}function gn(l={}){let{wrapper:n}=l.components||{};return n?(0,r.jsxDEV)(n,Object.assign({},l,{children:(0,r.jsxDEV)(Se,l,void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\"},this)}),void 0,!1,{fileName:\"/home/lucasmanoguerra/Documents/code/projets/blog-ui-next/src/content/posts/_mdx_bundler_entry_point-abc2c277-574e-4b00-9d4e-83290429efbf.mdx\"},this):Se(l)}var xn=gn;return hn(Nn);})();\n/*! Bundled license information:\n\nreact/cjs/react-jsx-dev-runtime.development.js:\n  (**\n   * @license React\n   * react-jsx-dev-runtime.development.js\n   *\n   * Copyright (c) Facebook, Inc. and its affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *)\n*/\n;return Component;"
  },
  "_id": "posts/nextjs-upgrade-next-image-and-dangerouslyallowsvg.mdx",
  "_raw": {
    "sourceFilePath": "posts/nextjs-upgrade-next-image-and-dangerouslyallowsvg.mdx",
    "sourceFileName": "nextjs-upgrade-next-image-and-dangerouslyallowsvg.mdx",
    "sourceFileDir": "posts",
    "contentType": "mdx",
    "flattenedPath": "posts/nextjs-upgrade-next-image-and-dangerouslyallowsvg"
  },
  "type": "Post",
  "slug": "/posts/nextjs-upgrade-next-image-and-dangerouslyallowsvg",
  "slugAsParams": "nextjs-upgrade-next-image-and-dangerouslyallowsvg"
}